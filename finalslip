<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Voter Slip</title>

<style>
/* ================= SCREEN ================= */
body{
  margin:0;
  font-family:Arial,sans-serif;
  min-height:100vh;
  background:url("laptop.png") center/cover no-repeat;
}
@media(max-width:768px){
  body{ background:url("mobile.png") center/cover no-repeat; }
}

/* Desktop center */
.container{
  max-width:360px;
  background:#fff;
  border:1px solid #000;
  padding:10px;
  position:absolute;
  top:50%;left:50%;
  transform:translate(-50%,-50%);
}

/* Mobile fix – keep search visible */
@media(max-width:768px){
  .container{
    position:relative;
    top:auto;left:auto;
    transform:none;
    margin:20px auto;
  }
}

select,input,button{
  width:100%;
  padding:6px;
  margin:4px 0;
  font-size:14px;
}

.result-card{
  border-top:1px dashed #000;
  margin-top:8px;
  padding-top:6px;
  font-size:14px;
}

.select-box{
  font-size:13px;
  margin-bottom:4px;
}

/* ================= PRINT (UNCHANGED) ================= */
@media print{
  @page{ size:58mm auto; margin:0; }

  body{
    width:58mm;
    margin:0;
    background:url("mobile.png") center/cover no-repeat;
    font-family:"Courier New", monospace;
  }

  .container,
  button,
  select,
  input{
    display:none!important;
  }

  .print-slip{
    width:48mm;
    margin:0 auto;
    padding:0;
    font-size:13px;
    font-weight:700;
    line-height:1.6;
    letter-spacing:.2px;
    page-break-after:always;
  }

  .p-title{
    text-align:center;
    font-weight:900;
    font-size:14px;
    margin-bottom:2mm;
  }

  .p-label{
    font-weight:900;
    display:inline;
  }

  .p-value{
    display:inline;
    margin-left:2mm;
  }

  .p-divider{
    border-top:1px dashed #000;
    margin:2mm 0;
  }
}
</style>
</head>

<body>

<div class="container">
  <select id="searchType">
    <option value="epic_no">EPIC No</option>
    <option value="name">Name</option>
    <option value="house_No">House No</option>
  </select>

  <input id="search" placeholder="Enter value">
  <button onclick="find()">Search</button>
  <button onclick="printSelected()">Print Selected</button>

  <div id="results"></div>
</div>

<!-- PRINT ROOT -->
<div id="printRoot"></div>

<script>
let voters=[];
fetch("https://opensheet.elk.sh/1xfIMsplZ_b4X4VI6D0AKUK5sQnVPRPFFgOhgJZUgAMc/Sheet1!A1:Z")
.then(r=>r.json())
.then(d=>voters=d);

/* Normalization */
const norm=v=>String(v||"")
  .toUpperCase()
  .replace(/\s+/g,"")
  .trim();

function find(){
  const t=searchType.value;
  const i=norm(search.value);
  const res=document.getElementById("results");
  res.innerHTML="";

  if(!i){
    res.innerHTML="<b>Please enter a value</b>";
    return;
  }

  const matches=voters.filter(v=>norm(v[t]).includes(i));

  if(!matches.length){
    res.innerHTML="<b>No record found</b>";
    return;
  }

  matches.forEach(v=>{
    const d=document.createElement("div");
    d.className="result-card";
    d.innerHTML=`
      <label class="select-box">
        <input type="checkbox" class="chk"> 
        <b>${v.name || "—"}</b> (${v.epic_no || "—"})
      </label>
      <button onclick='printOne(${JSON.stringify(v)})'>Print</button>
    `;
    d.querySelector(".chk").dataset.voter=JSON.stringify(v);
    res.appendChild(d);
  });
}

function buildSlip(v){
  return `
  <div class="print-slip">
    <div class="p-title">ORDINARY ELECTIONS – 2026</div>

    <span class="p-label">District :</span><span class="p-value">Karimnagar</span><br>
    <span class="p-label">Municipality :</span><span class="p-value">Karimnagar MC</span><br>
    <span class="p-label">Ward No :</span><span class="p-value">52</span><br>
    <span class="p-label">PS No :</span><span class="p-value">${v.ps_no||""}</span>

    <div class="p-divider"></div>

    <span class="p-label">Voter ID :</span><span class="p-value">${v.epic_no||""}</span><br>
    <span class="p-label">Name :</span><span class="p-value">${v.name||""}</span><br>
    <span class="p-label">Father/Husband :</span><span class="p-value">${v.relation_name||""}</span><br>
    <span class="p-label">Door No :</span><span class="p-value">${v.house_No||""}</span><br>
    <span class="p-label">Serial No :</span><span class="p-value">${v.serial_no||""}</span><br>
    <span class="p-label">Age/Gender :</span><span class="p-value">${v.age||""}/${v.gender||""}</span>

    <div class="p-divider"></div>

    <span class="p-label">PS Location :</span>
    <span class="p-value">
      Trinity Jnr College for Girls<br>
      Christian Colony, Room-2
    </span>
  </div>`;
}

function printOne(v){
  printRoot.innerHTML=buildSlip(v);
  window.print();
}

function printSelected(){
  let html="";
  document.querySelectorAll(".chk:checked").forEach(c=>{
    html+=buildSlip(JSON.parse(c.dataset.voter));
  });
  if(!html){
    alert("Please select at least one voter");
    return;
  }
  printRoot.innerHTML=html;
  window.print();
}
</script>

</body>
</html>
